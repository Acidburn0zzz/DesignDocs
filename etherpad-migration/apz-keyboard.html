<!doctype html>
<html lang="en">
<head>
<title>apz-keyboard</title>
<meta name="generator" content="Etherpad">
<meta name="author" content="Etherpad">
<meta name="changedby" content="Etherpad">
<meta charset="utf-8">
<style>
* {
  font-family: arial, sans-serif;
  font-size: 13px;
  line-height: 17px;
}
ul.indent {
  list-style-type: none;
}
ol {
  list-style-type: none;
  padding-left: 0;
}
body > ol {
  counter-reset: first second third fourth fifth sixth seventh eigth ninth tenth eleventh twelth thirteenth fourteenth fifteenth sixteenth;
}
ol > li:before {
  content: counter(first) ". ";
  counter-increment: first;
}
ol > ol > li:before {
  content: counter(first) "." counter(second) ". ";
  counter-increment: second;
}
ol > ol > ol > li:before {
  content: counter(first) "." counter(second) "." counter(third) ". ";
  counter-increment: third;
}
ol > ol > ol > ol > li:before {
  content: counter(first) "." counter(second) "." counter(third) "." counter(fourth) ". ";
  counter-increment: fourth;
}
ol > ol > ol > ol > ol > li:before {
  content: counter(first) "." counter(second) "." counter(third) "." counter(fourth) "." counter(fifth) ". ";
  counter-increment: fifth;
}
ol > ol > ol > ol > ol > ol > li:before {
  content: counter(first) "." counter(second) "." counter(third) "." counter(fourth) "." counter(fifth) "." counter(sixth) ". ";
  counter-increment: sixth;
}
ol > ol > ol > ol > ol > ol > ol > li:before {
  content: counter(first) "." counter(second) "." counter(third) "." counter(fourth) "." counter(fifth) "." counter(sixth) "." counter(seventh) ". ";
  counter-increment: seventh;
}
ol > ol > ol > ol > ol > ol > ol > ol > li:before {
  content: counter(first) "." counter(second) "." counter(third) "." counter(fourth) "." counter(fifth) "." counter(sixth) "." counter(seventh) "." counter(eigth) ". ";
  counter-increment: eigth;
}
ol > ol > ol > ol > ol > ol > ol > ol > ol > li:before {
  content: counter(first) "." counter(second) "." counter(third) "." counter(fourth) "." counter(fifth) "." counter(sixth) "." counter(seventh) "." counter(eigth) "." counter(ninth) ". ";
  counter-increment: ninth;
}
ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > li:before {
  content: counter(first) "." counter(second) "." counter(third) "." counter(fourth) "." counter(fifth) "." counter(sixth) "." counter(seventh) "." counter(eigth) "." counter(ninth) "." counter(tenth) ". ";
  counter-increment: tenth;
}
ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > li:before {
  content: counter(first) "." counter(second) "." counter(third) "." counter(fourth) "." counter(fifth) "." counter(sixth) "." counter(seventh) "." counter(eigth) "." counter(ninth) "." counter(tenth) "." counter(eleventh) ". ";
  counter-increment: eleventh;
}
ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > li:before {
  content: counter(first) "." counter(second) "." counter(third) "." counter(fourth) "." counter(fifth) "." counter(sixth) "." counter(seventh) "." counter(eigth) "." counter(ninth) "." counter(tenth) "." counter(eleventh) "." counter(twelth) ". ";
  counter-increment: twelth;
}
ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > li:before {
  content: counter(first) "." counter(second) "." counter(third) "." counter(fourth) "." counter(fifth) "." counter(sixth) "." counter(seventh) "." counter(eigth) "." counter(ninth) "." counter(tenth) "." counter(eleventh) "." counter(twelth) "." counter(thirteenth) ". ";
  counter-increment: thirteenth;
}
ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > li:before {
  content: counter(first) "." counter(second) "." counter(third) "." counter(fourth) "." counter(fifth) "." counter(sixth) "." counter(seventh) "." counter(eigth) "." counter(ninth) "." counter(tenth) "." counter(eleventh) "." counter(twelth) "." counter(thirteenth) "." counter(fourteenth) ". ";
  counter-increment: fourteenth;
}
ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > li:before {
  content: counter(first) "." counter(second) "." counter(third) "." counter(fourth) "." counter(fifth) "." counter(sixth) "." counter(seventh) "." counter(eigth) "." counter(ninth) "." counter(tenth) "." counter(eleventh) "." counter(twelth) "." counter(thirteenth) "." counter(fourteenth) "." counter(fifteenth) ". ";
  counter-increment: fifteenth;
}
ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > li:before {
  content: counter(first) "." counter(second) "." counter(third) "." counter(fourth) "." counter(fifth) "." counter(sixth) "." counter(seventh) "." counter(eigth) "." counter(ninth) "." counter(tenth) "." counter(eleventh) "." counter(twelth) "." counter(thirteenth) "." counter(fourteenth) "." counter(fifteenth) "." counter(sixthteenth) ". ";
  counter-increment: sixthteenth;
}
ol {
  text-indent: 0px;
}
ol > ol {
  text-indent: 10px;
}
ol > ol > ol {
  text-indent: 20px;
}
ol > ol > ol > ol {
  text-indent: 30px;
}
ol > ol > ol > ol > ol {
  text-indent: 40px;
}
ol > ol > ol > ol > ol > ol {
  text-indent: 50px;
}
ol > ol > ol > ol > ol > ol > ol {
  text-indent: 60px;
}
ol > ol > ol > ol > ol > ol > ol > ol {
  text-indent: 70px;
}
ol > ol > ol > ol > ol > ol > ol > ol > ol {
  text-indent: 80px;
}
ol > ol > ol > ol > ol > ol > ol > ol > ol > ol {
  text-indent: 90px;
}
ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol {
  text-indent: 100px;
}
ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol {
  text-indent: 110px;
}
ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol {
  text-indent: 120px;
}
ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol {
  text-indent: 130px;
}
ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol {
  text-indent: 140px;
}
ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol {
  text-indent: 150px;
}

</style>
</head>
<body>
<a href="https&#x3a;&#x2F;&#x2F;gist&#x2e;github&#x2e;com&#x2F;rlhunt&#x2F;63a47baaaed3e4f4cb7d17cbb318116c">https:&#x2F;&#x2F;gist.github.com&#x2F;rlhunt&#x2F;63a47baaaed3e4f4cb7d17cbb318116c</a><br><br>Getting Information<br>- seems reasonable<br>- For 2.i.b, RefLayers tend not to have a ViewID, so you might need to make the &quot;AsyncKeyboardScrollingTarget&quot; some sort of union type where it could be a ViewID or a sub-layer-tree-id<br><br>Input Handling<br>- I would prefer 2.ii instead of 2.i<br>- For 3.ii I think skipping async scrolling will probably be easier the initial version. the key listeners might also change focus which might be a little tricky to handle<br>--&gt; Yeah, I don&#x27;t think there&#x27;s much to be gained from waiting for a content response if there&#x27;s a keyboard event listener. If we have to wait for the content anyways, we might as well just have it do the scrolling. (For things like touch gestures, multiple events are coalesced into the same &quot;block&quot; and only the first one can be preventDefaulted, so it&#x27;s worthwhile to wait for a content response to subsequent events can be processed asynchronously. I don&#x27;t think that applies to keyboard events.)<br><br>I think we&#x27;ll also need to attach sequence numbers to events, as described in <a href="https&#x3a;&#x2F;&#x2F;public&#x2e;etherpad&#x2d;mozilla&#x2e;org&#x2F;p&#x2F;async&#x2d;keyboard&#x2d;scrolling">https:&#x2F;&#x2F;public.etherpad-mozilla.org&#x2F;p&#x2F;async-keyboard-scrolling</a><br><br>Building a &quot;KeyboardActionMap&quot;<br>- seems reasonable, i don&#x27;t know much about the XBL stuff<br>I assume the KeyboardActionMap can&#x27;t change over the course of the process&#x27; lifetime, and it&#x27;s thus sufficient to send it to APZ once on startup?<br><br>Questions<br>- For q1, the ancestor scrollable frame should have a ViewID even if it&#x27;s not layerized. We can check on the APZ side if it&#x27;s layerized or not (if it&#x27;s not, it will return true from IsScrollInfoLayer()) and skip APZ scrolling if it&#x27;s not layerized. The root scrollable should always be layerized and we&#x27;ll get the biggest wins there anyway<br>&nbsp; Being a scroll info layer isn&#x27;t the only reason a scroll frame might not be layerized. It could simply be inactive, in which case it won&#x27;t even have a ViewID. This is something we can detect on the Layout side (with FindIDFor()), and just send a null AsyncTarget if it&#x27;s the case. (Alternatively, we could consider layerizing a subframe whenever keyboard focus enters it, but that&#x27;s better left as an independent follow-up change.)<br>- For q2, this should work fine for webrender. We&#x27;ll need to send the AsyncKeyboardScrollingTarget information over in WebRenderScrollData (see the mIsFirstPaint flag in that class for a model to work off of)<br>- For q3, yeah I think sending the focus target per-repaint is probably the best place<br>
</body>
</html>
